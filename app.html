<!DOCTYPE html>
<html>
  <head>
    <!-- Insert this line above script imports  -->
    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>


    <script src="./libs/jquery-3.2.1.min.js"></script>

    <!-- Insert this line after script imports -->
    <script>if (window.module) module = window.module;</script>

    <meta charset="UTF-8">
    <title>Hello World!</title>
  </head>
  <body>
    <h1>Hello World!</h1>
    <!-- All of the Node.js APIs are available in this renderer process. -->
    We are using Node.js <script>document.write(process.versions.node)</script>,
    Chromium <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>.<br>


    Current Time: <span id="CURRENT_TIME"></span><br>
    AIN0 Value: <span id="AIN0_VAL"></span><br>

    <script>
      var cachedElements = {
        currentTime: $('#CURRENT_TIME'),
        ain0Val: $('#AIN0_VAL'),
      };
      // You can also require other files to run in this process
      var backend_manager = require('./backend_manager.js');
      var backendManager = backend_manager.backendManager;
      backendManager.on(backend_manager.events.BACKEND_STARTED, () => {
        console.log('backend has started')
      })

      backendManager.on(backend_manager.events.UPDATE_CURRENT_TIME, (time) => {
        // console.log('updating time');
        cachedElements.currentTime.text(time.toString());
      })

      backendManager.on(backend_manager.events.UPDATE_GAME_STATE, (data) => {
        // console.log('updating state',data);

        cachedElements.ain0Val.text(data.AIN0_VAL);
        cachedElements.currentTime.text(data.curTime.toString());
        // cachedElements.currentTime.text(time.toString());
      })
      



      


      $(document).ready(function() {
        console.log('READY');
        backendManager.initialize();
      })
      $(window).on('beforeunload', function(){
        console.log('unloading...')
        backendManager.terminate();
      });

    </script>


  </body>
</html>